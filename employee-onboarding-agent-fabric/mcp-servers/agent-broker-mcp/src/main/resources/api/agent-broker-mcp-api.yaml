openapi: 3.0.3
info:
  title: Employee Onboarding Agent Broker API
  description: |
    Agent Broker MCP Server for Employee Onboarding Process Orchestration - coordinates employee onboarding, asset allocation, and notifications.
    
    This service acts as the central orchestrator for the complete employee onboarding process, integrating with multiple MCP servers to provide:
    - Complete employee onboarding workflow orchestration
    - Multi-step process coordination with error handling
    - Integration with Employee Onboarding, Asset Allocation, and Notification MCP servers
    - Comprehensive status tracking and reporting
    - Failure recovery and retry mechanisms
    
    ## Key Features
    - **End-to-end Orchestration**: Manages the complete employee onboarding lifecycle
    - **Multi-Service Integration**: Coordinates between employee management, asset allocation, and notification services
    - **Error Handling**: Comprehensive error handling with detailed failure reporting
    - **Status Tracking**: Real-time status monitoring of onboarding progress
    - **Atomic Operations**: Ensures data consistency across all integrated services
    
    ## Orchestration Flow
    1. **Employee Profile Creation**: Creates employee record in the HR system
    2. **Asset Allocation**: Allocates required assets (laptop, ID card, phone, etc.)
    3. **Welcome Email**: Sends professional welcome email with onboarding information
    4. **Asset Notification**: Sends detailed asset allocation confirmation
    5. **Completion Notification**: Sends comprehensive onboarding completion summary
    
    ## Integration Architecture
    The Agent Broker integrates with:
    - **Employee Onboarding MCP**: Employee profile and data management
    - **Asset Allocation MCP**: IT asset allocation and tracking
    - **Notification MCP**: Email notification and communication services
    
    ## Error Handling
    - Service-level error handling with detailed error reporting
    - Automatic retry capabilities for transient failures
    - Comprehensive logging and audit trail
    - Graceful degradation for non-critical failures
  version: 1.0.0
  contact:
    name: MCP Development Team
    email: mcp-dev@company.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8084/api
    description: Local development server
  - url: https://agent-broker-mcp-server.us-e1.cloudhub.io/api
    description: Production CloudHub server

tags:
  - name: Health
    description: Service health and orchestration status
  - name: MCP Info
    description: MCP server information and capabilities
  - name: Orchestration
    description: Employee onboarding orchestration operations
  - name: Status Tracking
    description: Onboarding status and progress tracking
  - name: Recovery
    description: Error recovery and retry operations

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check endpoint
      description: Returns the current health status of the agent broker and orchestration capabilities
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [UP, DOWN]
                    example: UP
                  service:
                    type: string
                    example: Employee Onboarding Agent Broker
                  timestamp:
                    type: string
                    format: date-time
                    example: "2024-01-15 10:30:45"
                  orchestrationEnabled:
                    type: string
                    example: "true"

  /mcp/info:
    get:
      tags:
        - MCP Info
      summary: Get MCP server information
      description: Returns comprehensive information about the agent broker MCP server capabilities and integrated services
      operationId: getMcpInfo
      responses:
        '200':
          description: MCP server information
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: Employee Onboarding Agent Broker
                  version:
                    type: string
                    example: "1.0.0"
                  description:
                    type: string
                    example: Agent Broker MCP Server for Employee Onboarding Process Orchestration
                  tools:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        description:
                          type: string
                        endpoint:
                          type: string
                    example:
                      - name: orchestrate-employee-onboarding
                        description: Complete employee onboarding process orchestration
                        endpoint: /mcp/tools/orchestrate-employee-onboarding
                      - name: get-onboarding-status
                        description: Get employee onboarding process status
                        endpoint: /mcp/tools/get-onboarding-status
                      - name: retry-failed-step
                        description: Retry a failed onboarding step
                        endpoint: /mcp/tools/retry-failed-step

  /mcp/tools/orchestrate-employee-onboarding:
    post:
      tags:
        - Orchestration
      summary: Orchestrate complete employee onboarding process
      description: |
        Executes the complete employee onboarding workflow including:
        
        **Step 1: Employee Profile Creation**
        - Creates employee record in the HR system
        - Validates employee data and assigns employee ID
        - Establishes department and role associations
        
        **Step 2: Asset Allocation**
        - Allocates required IT assets based on role and department
        - Supports laptops, ID cards, mobile phones, access cards, and peripherals
        - Manages approval workflows for restricted asset categories
        
        **Step 3: Welcome Email Notification**
        - Sends professional welcome email with company information
        - Includes onboarding details, start date, and orientation information
        - Provides manager contact and next steps
        
        **Step 4: Asset Allocation Notification**
        - Sends detailed asset allocation confirmation
        - Includes asset specifications, care instructions, and policies
        - Provides IT contact information for support
        
        **Step 5: Onboarding Completion Notification**
        - Sends comprehensive onboarding completion summary
        - Includes complete asset inventory and employee information
        - Notifies HR and manager of successful completion
        
        The orchestration ensures atomic operations across all services with comprehensive error handling and rollback capabilities.
      operationId: orchestrateEmployeeOnboarding
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - firstName
                - lastName
                - email
              properties:
                firstName:
                  type: string
                  description: Employee's first name
                  example: John
                lastName:
                  type: string
                  description: Employee's last name
                  example: Smith
                email:
                  type: string
                  format: email
                  description: Employee's email address
                  example: john.smith@company.com
                department:
                  type: string
                  description: Employee's department
                  example: Engineering
                position:
                  type: string
                  description: Employee's job position
                  example: Senior Software Engineer
                startDate:
                  type: string
                  format: date
                  description: Employee's start date
                  example: "2024-01-15"
                manager:
                  type: string
                  description: Employee's direct manager
                  example: Sarah Johnson
                managerName:
                  type: string
                  description: Manager's full name for notifications
                  example: Sarah Johnson
                managerEmail:
                  type: string
                  format: email
                  description: Manager's email address
                  example: sarah.johnson@company.com
                orientationDate:
                  type: string
                  format: date
                  description: Scheduled orientation date
                  example: "2024-01-16"
                companyName:
                  type: string
                  description: Company name for personalization
                  example: TechCorp Inc
                assets:
                  type: array
                  description: Specific assets to allocate (optional - system will use role-based defaults)
                  items:
                    type: object
                    properties:
                      assetTag:
                        type: string
                        example: LAPTOP-001
                      category:
                        type: string
                        example: LAPTOP
                      priority:
                        type: string
                        enum: [HIGH, MEDIUM, LOW]
                        example: HIGH
      responses:
        '200':
          description: Employee onboarding orchestration completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Employee onboarding orchestration completed successfully
                  employeeId:
                    type: string
                    description: Generated employee ID
                    example: EMP001
                  employeeName:
                    type: string
                    example: John Smith
                  email:
                    type: string
                    example: john.smith@company.com
                  onboardingSteps:
                    type: object
                    properties:
                      profileCreation:
                        type: object
                        properties:
                          status:
                            type: string
                            enum: [completed, failed]
                            example: completed
                          result:
                            type: object
                            description: Employee creation service response
                      assetAllocation:
                        type: object
                        properties:
                          status:
                            type: string
                            enum: [completed, failed]
                            example: completed
                          assetsAllocated:
                            type: integer
                            example: 3
                          result:
                            type: object
                            description: Asset allocation service response
                      welcomeEmail:
                        type: object
                        properties:
                          status:
                            type: string
                            enum: [completed, failed]
                            example: completed
                          result:
                            type: object
                            description: Email notification service response
                      assetNotification:
                        type: object
                        properties:
                          status:
                            type: string
                            enum: [completed, failed]
                            example: completed
                          result:
                            type: object
                            description: Asset notification service response
                      onboardingComplete:
                        type: object
                        properties:
                          status:
                            type: string
                            enum: [completed, failed]
                            example: completed
                          result:
                            type: object
                            description: Completion notification service response
                  startTime:
                    type: string
                    format: date-time
                    example: "2024-01-15 09:00:00"
                  completionTime:
                    type: string
                    format: date-time
                    example: "2024-01-15 09:05:30"
                  totalDuration:
                    type: string
                    description: Total processing time
                    example: "PT5M30S"
                  timestamp:
                    type: string
                    format: date-time
        '500':
          description: Orchestration failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: Employee onboarding orchestration failed
                  error:
                    type: string
                    description: Detailed error description
                    example: HTTP:CONNECTIVITY - Unable to connect to Asset Allocation MCP Server
                  employeeEmail:
                    type: string
                    example: john.smith@company.com
                  failedAt:
                    type: string
                    description: Step where orchestration failed
                    example: Asset Allocation
                  startTime:
                    type: string
                    format: date-time
                    example: "2024-01-15 09:00:00"
                  errorTime:
                    type: string
                    format: date-time
                    example: "2024-01-15 09:02:15"
                  timestamp:
                    type: string
                    format: date-time

  /mcp/tools/get-onboarding-status:
    post:
      tags:
        - Status Tracking
      summary: Get employee onboarding status
      description: |
        Retrieves the current status of an employee's onboarding process by:
        - Querying the Employee Onboarding MCP for employee details
        - Checking asset allocation status
        - Verifying notification delivery status
        - Providing comprehensive status overview
      operationId: getOnboardingStatus
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - employeeId
              properties:
                employeeId:
                  type: string
                  description: Employee ID to get status for
                  example: EMP001
      responses:
        '200':
          description: Employee status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Employee status retrieved
                  employeeData:
                    type: object
                    description: Complete employee information from the Employee Onboarding MCP
                    properties:
                      employeeId:
                        type: string
                        example: EMP001
                      firstName:
                        type: string
                        example: John
                      lastName:
                        type: string
                        example: Smith
                      email:
                        type: string
                        example: john.smith@company.com
                      department:
                        type: string
                        example: Engineering
                      position:
                        type: string
                        example: Senior Software Engineer
                      startDate:
                        type: string
                        format: date
                        example: "2024-01-15"
                      status:
                        type: string
                        example: ACTIVE
                      onboardingStatus:
                        type: string
                        enum: [PENDING, IN_PROGRESS, COMPLETED, FAILED]
                        example: COMPLETED
                  timestamp:
                    type: string
                    format: date-time
        '500':
          description: Failed to retrieve employee status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /mcp/tools/retry-failed-step:
    post:
      tags:
        - Recovery
      summary: Retry a failed onboarding step
      description: |
        Provides retry functionality for failed onboarding steps. Currently returns a development placeholder.
        
        **Future Implementation Will Support:**
        - Individual step retry (profile creation, asset allocation, notifications)
        - Selective retry based on failure type
        - State recovery and continuation from failed point
        - Comprehensive retry logging and tracking
        
        **Planned Retry Scenarios:**
        - Network connectivity issues
        - Temporary service unavailability
        - Authentication/authorization failures
        - Data validation errors
        - Resource allocation conflicts
      operationId: retryFailedStep
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - employeeId
                - step
              properties:
                employeeId:
                  type: string
                  description: Employee ID for retry
                  example: EMP001
                step:
                  type: string
                  enum: [profileCreation, assetAllocation, welcomeEmail, assetNotification, onboardingComplete]
                  description: Step to retry
                  example: assetAllocation
                retryReason:
                  type: string
                  description: Reason for retry
                  example: Network connectivity restored
                maxRetries:
                  type: integer
                  description: Maximum number of retry attempts
                  default: 3
                  example: 3
      responses:
        '200':
          description: Retry functionality status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Retry functionality is under development
                  step:
                    type: string
                    example: assetAllocation
                  employeeId:
                    type: string
                    example: EMP001
                  timestamp:
                    type: string
                    format: date-time

components:
  schemas:
    OnboardingRequest:
      type: object
      required:
        - firstName
        - lastName
        - email
      properties:
        firstName:
          type: string
          minLength: 1
          maxLength: 50
        lastName:
          type: string
          minLength: 1
          maxLength: 50
        email:
          type: string
          format: email
        department:
          type: string
          maxLength: 100
        position:
          type: string
          maxLength: 100
        startDate:
          type: string
          format: date
        manager:
          type: string
          maxLength: 100
        managerName:
          type: string
          maxLength: 100
        managerEmail:
          type: string
          format: email
        orientationDate:
          type: string
          format: date
        companyName:
          type: string
          maxLength: 100
        assets:
          type: array
          items:
            $ref: '#/components/schemas/AssetRequest'

    AssetRequest:
      type: object
      properties:
        assetTag:
          type: string
          description: Specific asset tag if pre-assigned
        category:
          type: string
          enum: [LAPTOP, DESKTOP, ID_CARD, ACCESS_CARD, MOBILE_PHONE, TABLET, MONITOR, KEYBOARD, MOUSE, HEADSET, DOCKING_STATION, PARKING_PASS]
        priority:
          type: string
          enum: [HIGH, MEDIUM, LOW]
          default: MEDIUM

    OnboardingStep:
      type: object
      properties:
        status:
          type: string
          enum: [pending, in_progress, completed, failed]
        startTime:
          type: string
          format: date-time
        completionTime:
          type: string
          format: date-time
        duration:
          type: string
        result:
          type: object
          description: Service-specific response data
        error:
          type: string
          description: Error details if step failed

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: error
        message:
          type: string
        error:
          type: string
          description: Detailed error information
        timestamp:
          type: string
          format: date-time

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication
    
    OAuth2:
      type: oauth2
      flows:
        clientCredentials:
          tokenUrl: https://auth.company.com/oauth/token
          scopes:
            onboarding:read: Read onboarding data
            onboarding:write: Orchestrate onboarding processes
            onboarding:admin: Administrative onboarding operations

security:
  - ApiKeyAuth: []
  - OAuth2: [onboarding:write]

externalDocs:
  description: Agent Broker MCP Server Documentation
  url: https://github.com/mulesoft/agent-broker-mcp/blob/main/README.md
