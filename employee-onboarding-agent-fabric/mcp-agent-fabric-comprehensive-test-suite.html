<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP & Agent Fabric Comprehensive Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #667eea;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
        }

        .nav-tab:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .nav-tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .test-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border-left: 5px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }

        .test-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .test-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .test-card p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .test-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }

        .test-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .test-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            margin-bottom: 15px;
        }

        .result-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .result-success {
            border-left-color: #28a745;
            background: #f8fff9;
        }

        .result-error {
            border-left-color: #dc3545;
            background: #fff8f8;
        }

        .result-warning {
            border-left-color: #ffc107;
            background: #fffdf5;
        }

        .json-viewer {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-up { background: #28a745; }
        .status-down { background: #dc3545; }
        .status-warning { background: #ffc107; }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.5s ease;
        }

        .nlp-result {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #e0e0e0;
        }

        .nlp-intent {
            font-weight: bold;
            color: #667eea;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .nlp-confidence {
            background: #f0f8ff;
            padding: 8px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .nlp-entities {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .entity-tag {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .sentiment-bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .sentiment-positive {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 10px;
        }

        .sentiment-negative {
            height: 100%;
            background: linear-gradient(90deg, #dc3545, #fd7e14);
            border-radius: 10px;
        }

        .logs-panel {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-info { color: #63b3ed; }
        .log-success { color: #68d391; }
        .log-warning { color: #fbd38d; }
        .log-error { color: #f56565; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .floating-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: #667eea;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .floating-btn:hover {
            transform: scale(1.1);
            background: #5a6fd8;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .floating-controls {
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ MCP & Agent Fabric Test Suite</h1>
            <p>Comprehensive Testing Framework for Employee Onboarding System</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showTab('mcp-health')">üè• Health Checks</button>
            <button class="nav-tab" onclick="showTab('mcp-orchestration')">üéØ MCP Orchestration</button>
            <button class="nav-tab" onclick="showTab('mcp-individual')">üîß Individual MCPs</button>
            <button class="nav-tab" onclick="showTab('nlp-testing')">üß† NLP Testing</button>
            <button class="nav-tab" onclick="showTab('agent-fabric')">ü§ñ Agent Fabric</button>
            <button class="nav-tab" onclick="showTab('integration')">üîÑ Integration</button>
            <button class="nav-tab" onclick="showTab('performance')">‚ö° Performance</button>
            <button class="nav-tab" onclick="showTab('logs')">üìù Logs</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>System Overview Dashboard</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="total-tests">0</span>
                    <div class="stat-label">Total Tests</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="passed-tests">0</span>
                    <div class="stat-label">Passed</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="failed-tests">0</span>
                    <div class="stat-label">Failed</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="success-rate">0%</span>
                    <div class="stat-label">Success Rate</div>
                </div>
            </div>

            <div class="test-grid">
                <div class="test-card">
                    <h3>üè• System Health Status</h3>
                    <div id="health-summary">
                        <div><span class="status-indicator status-down"></span>Agent Broker MCP (Port 8080)</div>
                        <div><span class="status-indicator status-down"></span>Employee MCP (Port 8081)</div>
                        <div><span class="status-indicator status-down"></span>Asset MCP (Port 8082)</div>
                        <div><span class="status-indicator status-down"></span>Notification MCP (Port 8083)</div>
                    </div>
                    <button class="btn btn-primary" onclick="checkAllHealth()">Refresh Health Status</button>
                </div>

                <div class="test-card">
                    <h3>üéØ Quick MCP Orchestration Test</h3>
                    <p>Test the complete employee onboarding orchestration flow</p>
                    <input type="text" class="test-input" id="quick-employee-name" placeholder="Employee Name">
                    <input type="email" class="test-input" id="quick-employee-email" placeholder="Employee Email">
                    <button class="btn btn-success" onclick="quickOrchestrationTest()">Run Quick Test</button>
                </div>

                <div class="test-card">
                    <h3>üß† NLP Quick Test</h3>
                    <p>Test natural language processing capabilities</p>
                    <input type="text" class="test-input" id="quick-nlp-text" placeholder="Enter text to analyze..." value="Create new employee John Smith with email john@company.com">
                    <button class="btn btn-primary" onclick="quickNLPTest()">Analyze Text</button>
                </div>

                <div class="test-card">
                    <h3>üîÑ Run All Tests</h3>
                    <p>Execute comprehensive test suite covering all systems</p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="overall-progress"></div>
                    </div>
                    <button class="btn btn-warning" onclick="runAllTests()">Run All Tests</button>
                    <button class="btn btn-danger" onclick="stopAllTests()">Stop Tests</button>
                </div>
            </div>
        </div>

        <!-- Health Checks Tab -->
        <div id="mcp-health" class="tab-content">
            <h2>MCP Health Checks & System Status</h2>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>ü§ñ Agent Broker MCP (Port 8080)</h3>
                    <p>Main orchestration server - coordinates all onboarding operations</p>
                    <div id="broker-health-status">Status: <span id="broker-status">Checking...</span></div>
                    <button class="btn btn-primary" onclick="testAgentBrokerHealth()">Test Health</button>
                    <button class="btn btn-success" onclick="testAgentBrokerInfo()">Get Server Info</button>
                </div>

                <div class="test-card">
                    <h3>üë§ Employee Onboarding MCP (Port 8081)</h3>
                    <p>Employee profile creation and management service</p>
                    <div id="employee-health-status">Status: <span id="employee-status">Checking...</span></div>
                    <button class="btn btn-primary" onclick="testEmployeeHealth()">Test Health</button>
                    <button class="btn btn-success" onclick="testEmployeeEndpoints()">Test Endpoints</button>
                </div>

                <div class="test-card">
                    <h3>üì¶ Asset Allocation MCP (Port 8082)</h3>
                    <p>Asset management and allocation service</p>
                    <div id="asset-health-status">Status: <span id="asset-status">Checking...</span></div>
                    <button class="btn btn-primary" onclick="testAssetHealth()">Test Health</button>
                    <button class="btn btn-success" onclick="testAssetEndpoints()">Test Endpoints</button>
                </div>

                <div class="test-card">
                    <h3>üìß Notification MCP (Port 8083)</h3>
                    <p>Email and notification delivery service</p>
                    <div id="notification-health-status">Status: <span id="notification-status">Checking...</span></div>
                    <button class="btn btn-primary" onclick="testNotificationHealth()">Test Health</button>
                    <button class="btn btn-success" onclick="testNotificationEndpoints()">Test Endpoints</button>
                </div>
            </div>

            <div class="result-panel" id="health-results">
                <h4>Health Check Results</h4>
                <p>Click on any health check button above to see detailed results here.</p>
            </div>
        </div>

        <!-- MCP Orchestration Tab -->
        <div id="mcp-orchestration" class="tab-content">
            <h2>MCP Orchestration Testing</h2>
            
            <div class="test-card">
                <h3>Complete Employee Onboarding Orchestration</h3>
                <p>Test the full end-to-end employee onboarding process through MCP Agent Broker</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <input type="text" class="test-input" id="orch-firstname" placeholder="First Name" value="John">
                    <input type="text" class="test-input" id="orch-lastname" placeholder="Last Name" value="Smith">
                    <input type="email" class="test-input" id="orch-email" placeholder="Email" value="john.smith@company.com">
                    <input type="tel" class="test-input" id="orch-phone" placeholder="Phone" value="+1-555-0123">
                    <input type="text" class="test-input" id="orch-department" placeholder="Department" value="Engineering">
                    <input type="text" class="test-input" id="orch-position" placeholder="Position" value="Software Developer">
                    <input type="date" class="test-input" id="orch-startdate" placeholder="Start Date">
                    <input type="number" class="test-input" id="orch-salary" placeholder="Salary" value="75000">
                    <input type="text" class="test-input" id="orch-manager" placeholder="Manager Name" value="Jane Doe">
                    <input type="email" class="test-input" id="orch-manager-email" placeholder="Manager Email" value="jane.doe@company.com">
                </div>
                
                <textarea class="test-textarea" id="orch-assets" placeholder="Assets (JSON array)">["laptop", "phone", "id-card", "monitor"]</textarea>
                
                <button class="btn btn-success" onclick="testCompleteOrchestration()">üöÄ Start Orchestration</button>
                <button class="btn btn-primary" onclick="fillSampleData()">Fill Sample Data</button>
                <button class="btn btn-warning" onclick="testErrorScenarios()">Test Error Scenarios</button>
            </div>

            <div class="test-card">
                <h3>Orchestration Status & Monitoring</h3>
                <p>Check the status of ongoing or completed onboarding processes</p>
                
                <input type="text" class="test-input" id="status-employee-id" placeholder="Employee ID (e.g., EMP001)">
                <input type="email" class="test-input" id="status-employee-email" placeholder="Or Employee Email">
                
                <button class="btn btn-primary" onclick="testGetOnboardingStatus()">Get Status</button>
                <button class="btn btn-warning" onclick="testRetryFailedStep()">Retry Failed Step</button>
            </div>

            <div class="result-panel" id="orchestration-results">
                <h4>Orchestration Results</h4>
                <p>Orchestration test results will appear here...</p>
            </div>
        </div>

        <!-- Individual MCP Testing Tab -->
        <div id="mcp-individual" class="tab-content">
            <h2>Individual MCP Server Testing</h2>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>Employee MCP Direct Tests</h3>
                    <input type="text" class="test-input" id="emp-name" placeholder="Employee Name" value="Alice Johnson">
                    <input type="email" class="test-input" id="emp-email" placeholder="Email" value="alice@company.com">
                    <button class="btn btn-primary" onclick="testCreateEmployee()">Create Employee</button>
                    <button class="btn btn-success" onclick="testGetEmployees()">Get All Employees</button>
                    <button class="btn btn-warning" onclick="testGetEmployeeById()">Get by ID</button>
                </div>

                <div class="test-card">
                    <h3>Asset MCP Direct Tests</h3>
                    <input type="text" class="test-input" id="asset-employee-id" placeholder="Employee ID" value="EMP001">
                    <textarea class="test-textarea" id="asset-list" placeholder="Assets to allocate">["laptop", "phone", "monitor"]</textarea>
                    <button class="btn btn-primary" onclick="testAllocateAssets()">Allocate Assets</button>
                    <button class="btn btn-success" onclick="testGetAvailableAssets()">Get Available Assets</button>
                    <button class="btn btn-warning" onclick="testGetAssetsByEmployee()">Get Employee Assets</button>
                </div>

                <div class="test-card">
                    <h3>Notification MCP Direct Tests</h3>
                    <input type="email" class="test-input" id="notif-email" placeholder="Recipient Email" value="test@company.com">
                    <input type="text" class="test-input" id="notif-name" placeholder="Employee Name" value="Test User">
                    <button class="btn btn-primary" onclick="testSendWelcomeEmail()">Send Welcome Email</button>
                    <button class="btn btn-success" onclick="testSendAssetNotification()">Send Asset Notification</button>
                    <button class="btn btn-warning" onclick="testSendOnboardingComplete()">Send Completion Email</button>
                </div>
            </div>

            <div class="result-panel" id="individual-results">
                <h4>Individual MCP Test Results</h4>
                <p>Individual test results will appear here...</p>
            </div>
        </div>

        <!-- NLP Testing Tab -->
        <div id="nlp-testing" class="tab-content">
            <h2>NLP Engine Testing</h2>
            
            <div class="test-card">
                <h3>Intent Classification Testing</h3>
                <p>Test the NLP engine's ability to classify user intents</p>
                
                <textarea class="test-textarea" id="nlp-input" placeholder="Enter text to analyze...">Create a new employee named Sarah Wilson with email sarah.wilson@company.com for the Marketing department</textarea>
                
                <button class="btn btn-primary" onclick="testNLPProcessing()">Analyze Text</button>
                <button class="btn btn-success" onclick="runNLPTestSuite()">Run All NLP Tests</button>
                <button class="btn btn-warning" onclick="loadNLPSamples()">Load Sample Phrases</button>
            </div>

            <div class="test-card">
                <h3>Predefined Intent Test Cases</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px;">
                    <button class="btn btn-primary" onclick="testIntent('CREATE_EMPLOYEE')">CREATE_EMPLOYEE</button>
                    <button class="btn btn-primary" onclick="testIntent('ALLOCATE_ASSET')">ALLOCATE_ASSET</button>
                    <button class="btn btn-primary" onclick="testIntent('GET_ASSETS')">GET_ASSETS</button>
                    <button class="btn btn-primary" onclick="testIntent('GET_EMPLOYEE_STATUS')">GET_STATUS</button>
                    <button class="btn btn-primary" onclick="testIntent('SEND_NOTIFICATION')">SEND_NOTIFICATION</button>
                    <button class="btn btn-primary" onclick="testIntent('GET_EMPLOYEES')">GET_EMPLOYEES</button>
                </div>
            </div>

            <div class="result-panel" id="nlp-results">
                <h4>NLP Analysis Results</h4>
                <p>NLP processing results will appear here...</p>
            </div>
        </div>

        <!-- Agent Fabric Tab -->
        <div id="agent-fabric" class="tab-content">
            <h2>Agent Fabric & Chat Interface Testing</h2>
            
            <div class="test-card">
                <h3>Conversational Agent Testing</h3>
                <p>Test the complete Agent Fabric with natural language conversation</p>
                
                <div id="chat-interface" style="border: 2px solid #e0e0e0; border-radius: 8px; height: 400px; overflow-y: auto; padding: 15px; background: #f9f9f9; margin-bottom: 15px;">
                    <div class="chat-message system">
                        <strong>System:</strong> Agent Fabric initialized. You can now test natural language commands.
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <input type="text" class="test-input" id="chat-input" placeholder="Type your message..." style="flex: 1; margin-bottom: 0;">
                    <button class="btn btn-primary" onclick="sendChatMessage()">Send</button>
                </div>
                
                <div style="margin-top: 15px;">
                    <button class="btn btn-success" onclick="loadChatSamples()">Load Sample Conversations</button>
                    <button class="btn btn-warning" onclick="clearChat()">Clear Chat</button>
                    <button class="btn btn-primary" onclick="exportChatLog()">Export Chat Log</button>
                </div>
            </div>

            <div class="test-card">
                <h3>Agent Fabric Performance Metrics</h3>
                <div id="agent-metrics">
                    <p>Response Time: <span id="avg-response-time">-- ms</span></p>
                    <p>Success Rate: <span id="agent-success-rate">-- %</span></p>
                    <p>Total Interactions: <span id="total-interactions">0</span></p>
                </div>
                <button class="btn btn-primary" onclick="refreshAgentMetrics()">Refresh Metrics</button>
            </div>
        </div>

        <!-- Integration Testing Tab -->
        <div id="integration" class="tab-content">
            <h2>End-to-End Integration Testing</h2>
            
            <div class="test-card">
                <h3>Complete Workflow Integration</h3>
                <p>Test the entire system flow from NLP processing to MCP orchestration</p>
                
                <textarea class="test-textarea" id="integration-scenario" placeholder="Describe the integration scenario...">I need to onboard a new employee John Smith (john.smith@company.com) to the Engineering department as a Senior Developer starting next Monday. Please allocate him a laptop, phone, and monitor.</textarea>
                
                <button class="btn btn-success" onclick="testCompleteIntegration()">üîÑ Run Integration Test</button>
                <button class="btn btn-primary" onclick="runMultiUserScenario()">üë• Multi-User Scenario</button>
                <button class="btn btn-warning" onclick="testConcurrentRequests()">‚ö° Concurrent Requests</button>
            </div>

            <div class="test-card">
                <h3>Cross-System Validation</h3>
                <p>Validate data consistency across all MCP servers</p>
                <button class="btn btn-primary" onclick="validateDataConsistency()">Validate Consistency</button>
                <button class="btn btn-success" onclick="testRollbackScenario()">Test Rollback</button>
            </div>

            <div class="result-panel" id="integration-results">
                <h4>Integration Test Results</h4>
                <p>Integration test results will appear here...</p>
            </div>
        </div>

        <!-- Performance Testing Tab -->
        <div id="performance" class="tab-content">
            <h2>Performance & Load Testing</h2>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>Load Testing Configuration</h3>
                    <input type="number" class="test-input" id="load-users" placeholder="Concurrent Users" value="10">
                    <input type="number" class="test-input" id="load-duration" placeholder="Duration (seconds)" value="60">
                    <input type="number" class="test-input" id="load-ramp" placeholder="Ramp-up Time (seconds)" value="10">
                    <button class="btn btn-warning" onclick="runLoadTest()">üöÄ Start Load Test</button>
                    <button class="btn btn-danger" onclick="stopLoadTest()">Stop Test</button>
                </div>

                <div class="test-card">
                    <h3>Performance Metrics</h3>
                    <div id="performance-metrics">
                        <p>Average Response Time: <span id="perf-avg-time">-- ms</span></p>
                        <p>95th Percentile: <span id="perf-95th">-- ms</span></p>
                        <p>Throughput: <span id="perf-throughput">-- req/s</span></p>
                        <p>Error Rate: <span id="perf-error-rate">-- %</span></p>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="load-progress"></div>
                    </div>
                </div>
            </div>

            <div class="result-panel" id="performance-results">
                <h4>Performance Test Results</h4>
                <p>Performance metrics will be displayed here during testing...</p>
            </div>
        </div>

        <!-- Logs Tab -->
        <div id="logs" class="tab-content">
            <h2>System Logs & Monitoring</h2>
            
            <div class="test-card">
                <h3>Log Controls</h3>
                <button class="btn btn-primary" onclick="clearLogs()">Clear Logs</button>
                <button class="btn btn-success" onclick="exportLogs()">Export Logs</button>
                <button class="btn btn-warning" onclick="toggleAutoScroll()">Toggle Auto-Scroll</button>
                <select class="test-input" id="log-level">
                    <option value="all">All Levels</option>
                    <option value="info">Info</option>
                    <option value="warning">Warning</option>
                    <option value="error">Error</option>
                    <option value="success">Success</option>
                </select>
            </div>

            <div class="logs-panel" id="system-logs">
                <div class="log-entry log-info">[INFO] System initialized - Test suite ready</div>
            </div>
        </div>
    </div>

    <!-- Floating Controls -->
    <div class="floating-controls">
        <button class="floating-btn" onclick="scrollToTop()" title="Scroll to Top">‚Üë</button>
        <button class="floating-btn" onclick="toggleFullscreen()" title="Toggle Fullscreen">‚õ∂</button>
    </div>

    <!-- Modal for detailed results -->
    <div id="result-modal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <h3 id="modal-title">Test Results</h3>
            <div id="modal-content"></div>
        </div>
    </div>

    <script>
        // Global variables
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            running: false
        };

        let logAutoScroll = true;
        let agentMetrics = {
            responseTime: 0,
            successRate: 0,
            interactions: 0
        };

        // NLP Test Data
        const nlpTestCases = {
            CREATE_EMPLOYEE: [
                "Create a new employee John Smith with email john@company.com",
                "Add new staff member Sarah Johnson to the system",
                "Register employee Mike Wilson for the Engineering department",
                "Onboard new hire Lisa Chen starting next Monday"
            ],
            ALLOCATE_ASSET: [
                "Assign laptop to employee EMP001",
                "Allocate phone and monitor to John Smith",
                "Give new equipment to the Marketing team",
                "Provide laptop to employee john@company.com"
            ],
            GET_ASSETS: [
                "Show me available assets",
                "List all equipment in inventory",
                "What assets are available for allocation?",
                "Display current asset availability"
            ],
            GET_EMPLOYEE_STATUS: [
                "Check status of employee EMP001",
                "What is John Smith's onboarding progress?",
                "Show employee onboarding status",
                "Get progress for john@company.com"
            ],
            SEND_NOTIFICATION: [
                "Send welcome email to new employee",
                "Notify employee about asset allocation",
                "Send onboarding reminder",
                "Email completion notification"
            ],
            GET_EMPLOYEES: [
                "Show all employees",
                "List staff members",
                "Display employee directory",
                "Get all workers in the system"
            ]
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setDefaultDate();
            logMessage('info', 'Test Suite initialized successfully');
        });

        function initializeApp() {
            updateStats();
            checkAllHealth();
        }

        function setDefaultDate() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('orch-startdate').value = tomorrow.toISOString().split('T')[0];
        }

        // Tab Navigation
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');

            logMessage('info', `Switched to ${tabName} tab`);
        }

        // Logging System
        function logMessage(level, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${level}`;
            logEntry.textContent = `[${timestamp}] [${level.toUpperCase()}] ${message}`;

            const logsPanel = document.getElementById('system-logs');
            logsPanel.appendChild(logEntry);

            if (logAutoScroll) {
                logsPanel.scrollTop = logsPanel.scrollHeight;
            }

            // Also update console for debugging
            console.log(`[${level.toUpperCase()}] ${message}`);
        }

        function clearLogs() {
            document.getElementById('system-logs').innerHTML = '';
            logMessage('info', 'Logs cleared');
        }

        function exportLogs() {
            const logs = document.getElementById('system-logs').innerText;
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-logs-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            logMessage('success', 'Logs exported successfully');
        }

        function toggleAutoScroll() {
            logAutoScroll = !logAutoScroll;
            logMessage('info', `Auto-scroll ${logAutoScroll ? 'enabled' : 'disabled'}`);
        }

        // Statistics Management
        function updateStats() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('failed-tests').textContent = testStats.failed;
            const rate = testStats.total > 0 ? Math.round((testStats.passed / testStats.total) * 100) : 0;
            document.getElementById('success-rate').textContent = rate + '%';
        }

        function incrementTest(passed) {
            testStats.total++;
            if (passed) {
                testStats.passed++;
            } else {
                testStats.failed++;
            }
            updateStats();
        }

        // Health Check Functions
        async function checkAllHealth() {
            logMessage('info', 'Starting comprehensive health checks...');
            
            const services = [
                { name: 'Agent Broker MCP', port: 8080, id: 'broker' },
                { name: 'Employee MCP', port: 8081, id: 'employee' },
                { name: 'Asset MCP', port: 8082, id: 'asset' },
                { name: 'Notification MCP', port: 8083, id: 'notification' }
            ];

            for (const service of services) {
                await checkServiceHealth(service);
            }
        }

        async function checkServiceHealth(service) {
            try {
                logMessage('info', `Checking health of ${service.name}...`);
                
                const response = await fetch(`http://localhost:${service.port}/health`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' },
                    signal: AbortSignal.timeout(5000)
                });

                const isHealthy = response.ok;
                const statusElement = document.querySelector(`#health-summary div:nth-child(${getServiceIndex(service.port)}) .status-indicator`);
                
                if (statusElement) {
                    statusElement.className = `status-indicator ${isHealthy ? 'status-up' : 'status-down'}`;
                }

                const statusSpan = document.getElementById(`${service.id}-status`);
                if (statusSpan) {
                    statusSpan.textContent = isHealthy ? 'UP' : 'DOWN';
                    statusSpan.style.color = isHealthy ? '#28a745' : '#dc3545';
                }

                logMessage(isHealthy ? 'success' : 'error', 
                    `${service.name} health check: ${isHealthy ? 'UP' : 'DOWN'}`);
                
                incrementTest(isHealthy);
                
            } catch (error) {
                logMessage('error', `${service.name} health check failed: ${error.message}`);
                
                const statusElement = document.querySelector(`#health-summary div:nth-child(${getServiceIndex(service.port)}) .status-indicator`);
                if (statusElement) {
                    statusElement.className = 'status-indicator status-down';
                }
                
                const statusSpan = document.getElementById(`${service.id}-status`);
                if (statusSpan) {
                    statusSpan.textContent = 'DOWN';
                    statusSpan.style.color = '#dc3545';
                }
                
                incrementTest(false);
            }
        }

        function getServiceIndex(port) {
            const portMap = { 8080: 1, 8081: 2, 8082: 3, 8083: 4 };
            return portMap[port] || 1;
        }

        // Individual Health Check Functions
        async function testAgentBrokerHealth() {
            await testServiceHealth('Agent Broker MCP', 8080, 'broker-health-status');
        }

        async function testEmployeeHealth() {
            await testServiceHealth('Employee MCP', 8081, 'employee-health-status');
        }

        async function testAssetHealth() {
            await testServiceHealth('Asset MCP', 8082, 'asset-health-status');
        }

        async function testNotificationHealth() {
            await testServiceHealth('Notification MCP', 8083, 'notification-health-status');
        }

        async function testServiceHealth(serviceName, port, statusElementId) {
            const startTime = Date.now();
            
            try {
                logMessage('info', `Testing ${serviceName} health...`);
                
                const response = await fetch(`http://localhost:${port}/health`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' },
                    signal: AbortSignal.timeout(10000)
                });

                const responseTime = Date.now() - startTime;
                const data = await response.json();

                const result = {
                    success: response.ok,
                    status: response.status,
                    responseTime: responseTime,
                    data: data,
                    timestamp: new Date().toISOString()
                };

                displayResult('health-results', serviceName + ' Health Check', result);
                logMessage('success', `${serviceName} health check completed (${responseTime}ms)`);
                incrementTest(true);

            } catch (error) {
                const responseTime = Date.now() - startTime;
                const result = {
                    success: false,
                    error: error.message,
                    responseTime: responseTime,
                    timestamp: new Date().toISOString()
                };

                displayResult('health-results', serviceName + ' Health Check Failed', result);
                logMessage('error', `${serviceName} health check failed: ${error.message}`);
                incrementTest(false);
            }
        }

        // MCP Server Info Functions
        async function testAgentBrokerInfo() {
            try {
                logMessage('info', 'Retrieving Agent Broker MCP server information...');
                
                const response = await fetch('http://localhost:8080/mcp/info', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();
                displayResult('health-results', 'Agent Broker MCP Server Info', {
                    success: response.ok,
                    data: data
                });
                
                logMessage('success', 'Agent Broker info retrieved successfully');
                incrementTest(true);
                
            } catch (error) {
                logMessage('error', `Failed to get Agent Broker info: ${error.message}`);
                incrementTest(false);
            }
        }

        // Orchestration Testing Functions
        async function quickOrchestrationTest() {
            const name = document.getElementById('quick-employee-name').value;
            const email = document.getElementById('quick-employee-email').value;

            if (!name || !email) {
                alert('Please enter employee name and email');
                return;
            }

            const employeeData = {
                firstName: name.split(' ')[0],
                lastName: name.split(' ').slice(1).join(' '),
                email: email,
                department: 'Engineering',
                position: 'Developer',
                startDate: new Date().toISOString().split('T')[0],
                assets: ['laptop', 'phone']
            };

            await testOrchestration(employeeData);
        }

        async function testCompleteOrchestration() {
            const employeeData = {
                firstName: document.getElementById('orch-firstname').value,
                lastName: document.getElementById('orch-lastname').value,
                email: document.getElementById('orch-email').value,
                phone: document.getElementById('orch-phone').value,
                department: document.getElementById('orch-department').value,
                position: document.getElementById('orch-position').value,
                startDate: document.getElementById('orch-startdate').value,
                salary: parseInt(document.getElementById('orch-salary').value),
                manager: document.getElementById('orch-manager').value,
                managerEmail: document.getElementById('orch-manager-email').value,
                assets: JSON.parse(document.getElementById('orch-assets').value || '[]')
            };

            await testOrchestration(employeeData);
        }

        async function testOrchestration(employeeData) {
            const startTime = Date.now();
            
            try {
                logMessage('info', `Starting orchestration for ${employeeData.email}...`);
                
                const response = await fetch('http://localhost:8080/mcp/tools/orchestrate-employee-onboarding', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(employeeData)
                });

                const responseTime = Date.now() - startTime;
                const data = await response.json();

                const result = {
                    success: response.ok,
                    responseTime: responseTime,
                    data: data,
                    request: employeeData
                };

                displayResult('orchestration-results', 'Employee Onboarding Orchestration', result);
                
                if (response.ok) {
                    logMessage('success', `Orchestration completed successfully for ${employeeData.email} (${responseTime}ms)`);
                    incrementTest(true);
                } else {
                    logMessage('error', `Orchestration failed for ${employeeData.email}: ${data.message || 'Unknown error'}`);
                    incrementTest(false);
                }

            } catch (error) {
                const responseTime = Date.now() - startTime;
                logMessage('error', `Orchestration error for ${employeeData.email}: ${error.message}`);
                
                displayResult('orchestration-results', 'Orchestration Error', {
                    success: false,
                    error: error.message,
                    responseTime: responseTime,
                    request: employeeData
                });
                
                incrementTest(false);
            }
        }

        function fillSampleData() {
            document.getElementById('orch-firstname').value = 'Alice';
            document.getElementById('orch-lastname').value = 'Johnson';
            document.getElementById('orch-email').value = 'alice.johnson@company.com';
            document.getElementById('orch-phone').value = '+1-555-0456';
            document.getElementById('orch-department').value = 'Marketing';
            document.getElementById('orch-position').value = 'Marketing Manager';
            document.getElementById('orch-salary').value = '85000';
            document.getElementById('orch-manager').value = 'Bob Wilson';
            document.getElementById('orch-manager-email').value = 'bob.wilson@company.com';
            
            logMessage('info', 'Sample data filled');
        }

        // NLP Testing Functions
        async function quickNLPTest() {
            const text = document.getElementById('quick-nlp-text').value;
            if (!text) return;

            await processNLPText(text);
        }

        async function testNLPProcessing() {
            const text = document.getElementById('nlp-input').value;
            if (!text) {
                alert('Please enter text to analyze');
                return;
            }

            await processNLPText(text);
        }

        async function processNLPText(text) {
            const startTime = Date.now();
            
            try {
                logMessage('info', `Analyzing text: "${text.substring(0, 50)}..."`);
                
                // Simulate NLP processing (in real implementation, this would call the NLP service)
                const nlpResult = await simulateNLPProcessing(text);
                const responseTime = Date.now() - startTime;

                displayNLPResult(nlpResult, responseTime);
                logMessage('success', `NLP analysis completed (${responseTime}ms)`);
                incrementTest(true);

            } catch (error) {
                logMessage('error', `NLP processing failed: ${error.message}`);
                incrementTest(false);
            }
        }

        async function simulateNLPProcessing(text) {
            // Simulate processing delay
            await new Promise(resolve => setTimeout(resolve, 200 + Math.random() * 300));

            const tokens = text.toLowerCase().split(/\s+/);
            const entities = extractEntities(text);
            const intent = classifyIntent(text, tokens);
            const sentiment = analyzeSentiment(text);
            const confidence = calculateConfidence(intent, entities, text);

            return {
                originalText: text,
                tokens: tokens,
                entities: entities,
                intent: intent,
                confidence: confidence,
                sentiment: sentiment,
                keyPhrases: extractKeyPhrases(text),
                processingTime: Date.now()
            };
        }

        function extractEntities(text) {
            const entities = [];
            
            // Extract emails
            const emailRegex = /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g;
            const emails = text.match(emailRegex);
            if (emails) {
                emails.forEach(email => entities.push({ text: email, label: 'EMAIL', confidence: 0.9 }));
            }

            // Extract names (simple pattern)
            const nameRegex = /\b[A-Z][a-z]+\s+[A-Z][a-z]+\b/g;
            const names = text.match(nameRegex);
            if (names) {
                names.forEach(name => entities.push({ text: name, label: 'PERSON', confidence: 0.8 }));
            }

            // Extract employee IDs
            const empIdRegex = /EMP\d{3,}/gi;
            const empIds = text.match(empIdRegex);
            if (empIds) {
                empIds.forEach(id => entities.push({ text: id, label: 'EMPLOYEE_ID', confidence: 0.9 }));
            }

            // Extract assets
            const assets = ['laptop', 'phone', 'monitor', 'computer', 'tablet', 'keyboard', 'mouse'];
            assets.forEach(asset => {
                if (text.toLowerCase().includes(asset)) {
                    entities.push({ text: asset, label: 'ASSET', confidence: 0.7 });
                }
            });

            return entities;
        }

        function classifyIntent(text, tokens) {
            const intentKeywords = {
                CREATE_EMPLOYEE: ['create', 'add', 'new', 'register', 'onboard', 'hire', 'employee'],
                ALLOCATE_ASSET: ['allocate', 'assign', 'give', 'provide', 'laptop', 'phone', 'equipment'],
                GET_ASSETS: ['show', 'list', 'get', 'available', 'assets', 'inventory'],
                GET_EMPLOYEE_STATUS: ['status', 'progress', 'check', 'onboarding'],
                SEND_NOTIFICATION: ['send', 'notify', 'notification', 'email', 'message'],
                GET_EMPLOYEES: ['employees', 'staff', 'people', 'workers', 'directory']
            };

            let bestIntent = 'UNKNOWN';
            let highestScore = 0;

            Object.keys(intentKeywords).forEach(intent => {
                let score = 0;
                intentKeywords[intent].forEach(keyword => {
                    if (tokens.includes(keyword) || text.toLowerCase().includes(keyword)) {
                        score++;
                    }
                });

                if (score > highestScore) {
                    highestScore = score;
                    bestIntent = intent;
                }
            });

            return highestScore > 0 ? bestIntent : 'UNKNOWN';
        }

        function analyzeSentiment(text) {
            // Simple sentiment analysis
            const positiveWords = ['good', 'great', 'excellent', 'amazing', 'wonderful', 'fantastic', 'perfect'];
            const negativeWords = ['bad', 'terrible', 'awful', 'horrible', 'disgusting', 'hate', 'worst'];

            let positiveCount = 0;
            let negativeCount = 0;

            const words = text.toLowerCase().split(/\s+/);
            words.forEach(word => {
                if (positiveWords.includes(word)) positiveCount++;
                if (negativeWords.includes(word)) negativeCount++;
            });

            const score = positiveCount - negativeCount;
            const comparative = words.length > 0 ? score / words.length : 0;

            return {
                score: score,
                comparative: comparative,
                positive: positiveWords.filter(word => words.includes(word)),
                negative: negativeWords.filter(word => words.includes(word))
            };
        }

        function extractKeyPhrases(text) {
            const words = text.split(/\s+/);
            const keyPhrases = [];
            
            // Extract 2-word phrases
            for (let i = 0; i < words.length - 1; i++) {
                const phrase = words[i] + ' ' + words[i + 1];
                if (phrase.length > 5) {
                    keyPhrases.push({ text: phrase, type: 'phrase' });
                }
            }

            return keyPhrases.slice(0, 5);
        }

        function calculateConfidence(intent, entities, text) {
            let confidence = 0;
            
            if (intent !== 'UNKNOWN') {
                confidence += 0.5;
                if (entities.length > 0) {
                    confidence += Math.min(entities.length * 0.1, 0.3);
                }
            }
            
            if (text.length > 10 && text.length < 200) {
                confidence += 0.2;
            }

            return Math.min(confidence, 1.0);
        }

        function displayNLPResult(result, responseTime) {
            const resultsDiv = document.getElementById('nlp-results');
            
            let html = `
                <h4>NLP Analysis Results (${responseTime}ms)</h4>
                <div class="nlp-result">
                    <div class="nlp-intent">Intent: ${result.intent}</div>
                    <div class="nlp-confidence">Confidence: ${Math.round(result.confidence * 100)}%</div>
                    
                    <div><strong>Entities Found:</strong></div>
                    <div class="nlp-entities">
                        ${result.entities.map(entity => 
                            `<span class="entity-tag">${entity.text} (${entity.label})</span>`
                        ).join('')}
                    </div>
                    
                    <div><strong>Sentiment Analysis:</strong></div>
                    <div class="sentiment-bar">
                        <div class="${result.sentiment.score >= 0 ? 'sentiment-positive' : 'sentiment-negative'}" 
                             style="width: ${Math.abs(result.sentiment.score) * 20}%"></div>
                    </div>
                    <p>Score: ${result.sentiment.score} | Comparative: ${result.sentiment.comparative.toFixed(3)}</p>
                    
                    <div class="json-viewer">${JSON.stringify(result, null, 2)}</div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
            resultsDiv.className = 'result-panel result-success';
        }

        async function testIntent(intentType) {
            const testPhrases = nlpTestCases[intentType];
            if (!testPhrases) return;

            const randomPhrase = testPhrases[Math.floor(Math.random() * testPhrases.length)];
            document.getElementById('nlp-input').value = randomPhrase;
            
            await processNLPText(randomPhrase);
            logMessage('info', `Tested intent ${intentType} with phrase: "${randomPhrase}"`);
        }

        async function runNLPTestSuite() {
            logMessage('info', 'Starting comprehensive NLP test suite...');
            
            let totalTests = 0;
            let passedTests = 0;

            for (const [intent, phrases] of Object.entries(nlpTestCases)) {
                for (const phrase of phrases) {
                    try {
                        const result = await simulateNLPProcessing(phrase);
                        totalTests++;
                        
                        if (result.intent === intent) {
                            passedTests++;
                            logMessage('success', `‚úì ${intent}: "${phrase}" - Correct classification`);
                        } else {
                            logMessage('warning', `‚ö† ${intent}: "${phrase}" - Classified as ${result.intent}`);
                        }
                        
                        // Small delay between tests
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                    } catch (error) {
                        logMessage('error', `‚úó ${intent}: "${phrase}" - Error: ${error.message}`);
                    }
                }
            }

            const accuracy = totalTests > 0 ? (passedTests / totalTests * 100).toFixed(1) : 0;
            logMessage('info', `NLP Test Suite completed: ${passedTests}/${totalTests} tests passed (${accuracy}% accuracy)`);
            
            displayResult('nlp-results', 'NLP Test Suite Results', {
                totalTests,
                passedTests,
                accuracy: accuracy + '%',
                timestamp: new Date().toISOString()
            });
        }

        function loadNLPSamples() {
            const allPhrases = Object.values(nlpTestCases).flat();
            const randomPhrase = allPhrases[Math.floor(Math.random() * allPhrases.length)];
            document.getElementById('nlp-input').value = randomPhrase;
            logMessage('info', 'Random sample phrase loaded');
        }

        // Chat Interface Functions
        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            const chatInterface = document.getElementById('chat-interface');
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user';
            userMessage.innerHTML = `<strong>User:</strong> ${message}`;
            chatInterface.appendChild(userMessage);

            // Clear input
            input.value = '';

            // Process with NLP and respond
            try {
                const startTime = Date.now();
                const nlpResult = await simulateNLPProcessing(message);
                const responseTime = Date.now() - startTime;
                
                agentMetrics.interactions++;
                agentMetrics.responseTime = ((agentMetrics.responseTime * (agentMetrics.interactions - 1)) + responseTime) / agentMetrics.interactions;
                
                // Generate response based on intent
                const response = await generateAgentResponse(nlpResult);
                
                // Add agent response
                const agentMessage = document.createElement('div');
                agentMessage.className = 'chat-message agent';
                agentMessage.innerHTML = `<strong>Agent:</strong> ${response}`;
                chatInterface.appendChild(agentMessage);
                
                // Scroll to bottom
                chatInterface.scrollTop = chatInterface.scrollHeight;
                
                logMessage('info', `Chat interaction processed: ${nlpResult.intent} (${responseTime}ms)`);
                updateAgentMetrics();
                
            } catch (error) {
                logMessage('error', `Chat processing failed: ${error.message}`);
                
                const errorMessage = document.createElement('div');
                errorMessage.className = 'chat-message error';
                errorMessage.innerHTML = `<strong>Error:</strong> ${error.message}`;
                chatInterface.appendChild(errorMessage);
            }
        }

        async function generateAgentResponse(nlpResult) {
            const responses = {
                CREATE_EMPLOYEE: [
                    "I'll help you create a new employee profile. Let me process that information...",
                    "Creating employee record now. This will include profile setup and initial asset allocation.",
                    "Processing employee onboarding request. I'll coordinate all the necessary steps."
                ],
                ALLOCATE_ASSET: [
                    "I'll allocate the requested assets to the employee. Checking availability...",
                    "Processing asset allocation request. I'll update the inventory and notify relevant departments.",
                    "Asset allocation initiated. I'll ensure proper assignment and documentation."
                ],
                GET_ASSETS: [
                    "Here are the currently available assets in our inventory.",
                    "Let me retrieve the latest asset availability information for you.",
                    "Checking asset inventory status across all departments."
                ],
                GET_EMPLOYEE_STATUS: [
                    "Let me check the current onboarding status for that employee.",
                    "Retrieving employee progress information from our systems.",
                    "Checking onboarding milestones and completion status."
                ],
                SEND_NOTIFICATION: [
                    "I'll send the requested notification right away.",
                    "Processing notification request. The message will be delivered shortly.",
                    "Notification queued for delivery. I'll confirm once sent."
                ],
                GET_EMPLOYEES: [
                    "Here's the current employee directory information.",
                    "Retrieving employee list from our HR systems.",
                    "Compiling employee directory with current status information."
                ],
                UNKNOWN: [
                    "I'm not sure I understand that request. Could you please clarify?",
                    "I need more information to help you with that. Can you be more specific?",
                    "Let me know how I can assist you with employee onboarding tasks."
                ]
            };

            const intentResponses = responses[nlpResult.intent] || responses.UNKNOWN;
            const randomResponse = intentResponses[Math.floor(Math.random() * intentResponses.length)];
            
            // Add entity-specific information
            if (nlpResult.entities.length > 0) {
                const entityInfo = nlpResult.entities.map(e => `${e.text} (${e.label})`).join(', ');
                return `${randomResponse} I detected: ${entityInfo}`;
            }
            
            return randomResponse;
        }

        function loadChatSamples() {
            const sampleConversations = [
                "Create employee John Smith with email john@company.com",
                "What's the status of employee EMP001?",
                "Allocate laptop and phone to new hire",
                "Show me available equipment",
                "Send welcome email to new employee"
            ];
            
            const chatInterface = document.getElementById('chat-interface');
            sampleConversations.forEach(sample => {
                const sampleMessage = document.createElement('div');
                sampleMessage.className = 'chat-message sample';
                sampleMessage.innerHTML = `<strong>Sample:</strong> ${sample} <button onclick="document.getElementById('chat-input').value='${sample}'" class="btn btn-primary" style="margin-left: 10px; padding: 2px 8px; font-size: 12px;">Try</button>`;
                chatInterface.appendChild(sampleMessage);
            });
            
            logMessage('info', 'Sample conversations loaded');
        }

        function clearChat() {
            document.getElementById('chat-interface').innerHTML = '<div class="chat-message system"><strong>System:</strong> Chat cleared. Agent Fabric ready for new conversation.</div>';
            logMessage('info', 'Chat interface cleared');
        }

        function exportChatLog() {
            const chatContent = document.getElementById('chat-interface').innerText;
            const blob = new Blob([chatContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `chat-log-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            logMessage('success', 'Chat log exported');
        }

        function updateAgentMetrics() {
            document.getElementById('avg-response-time').textContent = Math.round(agentMetrics.responseTime) + ' ms';
            document.getElementById('total-interactions').textContent = agentMetrics.interactions;
            
            const successRate = testStats.total > 0 ? Math.round((testStats.passed / testStats.total) * 100) : 0;
            document.getElementById('agent-success-rate').textContent = successRate + '%';
        }

        function refreshAgentMetrics() {
            updateAgentMetrics();
            logMessage('info', 'Agent metrics refreshed');
        }

        // Individual MCP Testing Functions
        async function testCreateEmployee() {
            const name = document.getElementById('emp-name').value;
            const email = document.getElementById('emp-email').value;
            
            const employeeData = {
                name: name,
                email: email,
                department: 'Engineering',
                position: 'Developer'
            };

            try {
                logMessage('info', `Creating employee: ${name}`);
                // Simulate API call (replace with actual endpoint when available)
                await simulateAPICall('POST', 'http://localhost:8081/mcp/tools/create-employee', employeeData);
                displayResult('individual-results', 'Create Employee', { success: true, data: employeeData });
                incrementTest(true);
            } catch (error) {
                logMessage('error', `Employee creation failed: ${error.message}`);
                displayResult('individual-results', 'Create Employee Failed', { success: false, error: error.message });
                incrementTest(false);
            }
        }

        async function testAllocateAssets() {
            const employeeId = document.getElementById('asset-employee-id').value;
            const assets = JSON.parse(document.getElementById('asset-list').value || '[]');
            
            const allocationData = {
                employeeId: employeeId,
                assets: assets
            };

            try {
                logMessage('info', `Allocating assets to ${employeeId}: ${assets.join(', ')}`);
                await simulateAPICall('POST', 'http://localhost:8082/mcp/tools/allocate-assets', allocationData);
                displayResult('individual-results', 'Asset Allocation', { success: true, data: allocationData });
                incrementTest(true);
            } catch (error) {
                logMessage('error', `Asset allocation failed: ${error.message}`);
                displayResult('individual-results', 'Asset Allocation Failed', { success: false, error: error.message });
                incrementTest(false);
            }
        }

        async function testSendWelcomeEmail() {
            const email = document.getElementById('notif-email').value;
            const name = document.getElementById('notif-name').value;
            
            const emailData = {
                email: email,
                name: name,
                template: 'welcome'
            };

            try {
                logMessage('info', `Sending welcome email to ${email}`);
                await simulateAPICall('POST', 'http://localhost:8083/mcp/tools/send-welcome-email', emailData);
                displayResult('individual-results', 'Welcome Email', { success: true, data: emailData });
                incrementTest(true);
            } catch (error) {
                logMessage('error', `Welcome email failed: ${error.message}`);
                displayResult('individual-results', 'Welcome Email Failed', { success: false, error: error.message });
                incrementTest(false);
            }
        }

        // Integration Testing Functions
        async function testCompleteIntegration() {
            const scenario = document.getElementById('integration-scenario').value;
            
            try {
                logMessage('info', 'Starting end-to-end integration test...');
                
                // Step 1: Process with NLP
                const nlpResult = await simulateNLPProcessing(scenario);
                logMessage('info', `NLP processing completed - Intent: ${nlpResult.intent}`);
                
                // Step 2: Extract employee data from entities
                const employeeData = extractEmployeeDataFromNLP(nlpResult);
                
                // Step 3: Orchestrate through MCP
                if (employeeData) {
                    await testOrchestration(employeeData);
                }
                
                displayResult('integration-results', 'Complete Integration Test', {
                    success: true,
                    nlpResult: nlpResult,
                    employeeData: employeeData,
                    timestamp: new Date().toISOString()
                });
                
                logMessage('success', 'Integration test completed successfully');
                
            } catch (error) {
                logMessage('error', `Integration test failed: ${error.message}`);
                displayResult('integration-results', 'Integration Test Failed', {
                    success: false,
                    error: error.message
                });
                incrementTest(false);
            }
        }

        function extractEmployeeDataFromNLP(nlpResult) {
            const employeeData = {
                firstName: 'John',
                lastName: 'Doe',
                email: 'john.doe@company.com',
                department: 'Engineering',
                position: 'Developer',
                startDate: new Date().toISOString().split('T')[0],
                assets: ['laptop']
            };

            // Extract entities
            nlpResult.entities.forEach(entity => {
                switch (entity.label) {
                    case 'EMAIL':
                        employeeData.email = entity.text;
                        break;
                    case 'PERSON':
                        const names = entity.text.split(' ');
                        employeeData.firstName = names[0];
                        employeeData.lastName = names.slice(1).join(' ');
                        break;
                    case 'ASSET':
                        if (!employeeData.assets.includes(entity.text)) {
                            employeeData.assets.push(entity.text);
                        }
                        break;
                }
            });

            return employeeData;
        }

        // Performance Testing Functions
        let loadTestRunning = false;
        let loadTestResults = [];

        async function runLoadTest() {
            if (loadTestRunning) return;
            
            const users = parseInt(document.getElementById('load-users').value);
            const duration = parseInt(document.getElementById('load-duration').value);
            const rampUp = parseInt(document.getElementById('load-ramp').value);
            
            loadTestRunning = true;
            loadTestResults = [];
            
            logMessage('info', `Starting load test: ${users} users, ${duration}s duration, ${rampUp}s ramp-up`);
            
            const startTime = Date.now();
            const endTime = startTime + (duration * 1000);
            let completedRequests = 0;
            
            // Ramp up users gradually
            for (let i = 0; i < users; i++) {
                setTimeout(() => {
                    if (loadTestRunning) {
                        runLoadTestWorker(endTime, completedRequests);
                    }
                }, (i * rampUp * 1000) / users);
            }
            
            // Monitor progress
            const progressInterval = setInterval(() => {
                if (!loadTestRunning) {
                    clearInterval(progressInterval);
                    return;
                }
                
                const elapsed = Date.now() - startTime;
                const progress = Math.min((elapsed / (duration * 1000)) * 100, 100);
                document.getElementById('load-progress').style.width = progress + '%';
                
                updatePerformanceMetrics();
                
                if (elapsed >= duration * 1000) {
                    stopLoadTest();
                }
            }, 1000);
        }

        async function runLoadTestWorker(endTime, completedRequests) {
            while (loadTestRunning && Date.now() < endTime) {
                try {
                    const requestStart = Date.now();
                    await simulateAPICall('GET', 'http://localhost:8080/health');
                    const responseTime = Date.now() - requestStart;
                    
                    loadTestResults.push({
                        responseTime: responseTime,
                        success: true,
                        timestamp: Date.now()
                    });
                    
                    completedRequests++;
                    
                } catch (error) {
                    loadTestResults.push({
                        responseTime: 0,
                        success: false,
                        error: error.message,
                        timestamp: Date.now()
                    });
                }
                
                // Random delay between requests
                await new Promise(resolve => setTimeout(resolve, 100 + Math.random() * 400));
            }
        }

        function stopLoadTest() {
            loadTestRunning = false;
            document.getElementById('load-progress').style.width = '100%';
            
            // Calculate final metrics
            const totalRequests = loadTestResults.length;
            const successfulRequests = loadTestResults.filter(r => r.success).length;
            const responseTimes = loadTestResults.filter(r => r.success).map(r => r.responseTime);
            
            const avgResponseTime = responseTimes.length > 0 ? 
                responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length : 0;
            
            const sortedTimes = responseTimes.sort((a, b) => a - b);
            const p95Index = Math.floor(sortedTimes.length * 0.95);
            const p95ResponseTime = sortedTimes[p95Index] || 0;
            
            const errorRate = totalRequests > 0 ? ((totalRequests - successfulRequests) / totalRequests) * 100 : 0;
            
            displayResult('performance-results', 'Load Test Results', {
                totalRequests: totalRequests,
                successfulRequests: successfulRequests,
                averageResponseTime: Math.round(avgResponseTime),
                p95ResponseTime: Math.round(p95ResponseTime),
                errorRate: Math.round(errorRate * 100) / 100,
                throughput: Math.round((totalRequests / 60) * 100) / 100
            });
            
            logMessage('info', `Load test completed: ${totalRequests} requests, ${Math.round(errorRate)}% error rate`);
        }

        function updatePerformanceMetrics() {
            if (loadTestResults.length === 0) return;
            
            const recentResults = loadTestResults.slice(-100); // Last 100 requests
            const successfulResults = recentResults.filter(r => r.success);
            
            if (successfulResults.length > 0) {
                const avgTime = successfulResults.reduce((a, b) => a + b.responseTime, 0) / successfulResults.length;
                document.getElementById('perf-avg-time').textContent = Math.round(avgTime) + ' ms';
                
                const sortedTimes = successfulResults.map(r => r.responseTime).sort((a, b) => a - b);
                const p95Index = Math.floor(sortedTimes.length * 0.95);
                document.getElementById('perf-95th').textContent = Math.round(sortedTimes[p95Index] || 0) + ' ms';
            }
            
            const errorRate = recentResults.length > 0 ? 
                ((recentResults.length - successfulResults.length) / recentResults.length) * 100 : 0;
            document.getElementById('perf-error-rate').textContent = Math.round(errorRate) + ' %';
            
            document.getElementById('perf-throughput').textContent = Math.round(recentResults.length / 10) + ' req/s';
        }

        // Utility Functions
        async function simulateAPICall(method, url, data = null) {
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 100 + Math.random() * 300));
            
            // Simulate occasional failures
            if (Math.random() < 0.05) {
                throw new Error('Simulated network error');
            }
            
            return {
                status: 200,
                data: data || { success: true, message: 'API call successful' }
            };
        }

        function displayResult(containerId, title, result) {
            const container = document.getElementById(containerId);
            const resultClass = result.success ? 'result-success' : 'result-error';
            
            container.innerHTML = `
                <h4>${title}</h4>
                <div class="json-viewer">${JSON.stringify(result, null, 2)}</div>
            `;
            container.className = `result-panel ${resultClass}`;
        }

        // Global Test Functions
        async function runAllTests() {
            if (testStats.running) return;
            
            testStats.running = true;
            logMessage('info', 'Starting comprehensive test suite...');
            
            const totalSteps = 8;
            let currentStep = 0;
            
            const updateProgress = () => {
                currentStep++;
                const progress = (currentStep / totalSteps) * 100;
                document.getElementById('overall-progress').style.width = progress + '%';
            };
            
            try {
                // Step 1: Health Checks
                logMessage('info', 'Step 1/8: Health Checks');
                await checkAllHealth();
                updateProgress();
                
                // Step 2: MCP Server Info
                logMessage('info', 'Step 2/8: MCP Server Info');
                await testAgentBrokerInfo();
                updateProgress();
                
                // Step 3: NLP Test Suite
                logMessage('info', 'Step 3/8: NLP Test Suite');
                await runNLPTestSuite();
                updateProgress();
                
                // Step 4: Individual MCP Tests
                logMessage('info', 'Step 4/8: Individual MCP Tests');
                await testCreateEmployee();
                await testAllocateAssets();
                await testSendWelcomeEmail();
                updateProgress();
                
                // Step 5: Orchestration Test
                logMessage('info', 'Step 5/8: Orchestration Test');
                await quickOrchestrationTest();
                updateProgress();
                
                // Step 6: Integration Test
                logMessage('info', 'Step 6/8: Integration Test');
                await testCompleteIntegration();
                updateProgress();
                
                // Step 7: Performance Test (short)
                logMessage('info', 'Step 7/8: Performance Test');
                document.getElementById('load-duration').value = '30';
                await runLoadTest();
                await new Promise(resolve => setTimeout(resolve, 5000));
                stopLoadTest();
                updateProgress();
                
                // Step 8: Final validation
                logMessage('info', 'Step 8/8: Final Validation');
                await validateDataConsistency();
                updateProgress();
                
                logMessage('success', 'All tests completed successfully!');
                
            } catch (error) {
                logMessage('error', `Test suite failed: ${error.message}`);
            }
            
            testStats.running = false;
        }

        function stopAllTests() {
            testStats.running = false;
            loadTestRunning = false;
            document.getElementById('overall-progress').style.width = '0%';
            logMessage('warning', 'Test suite stopped by user');
        }

        async function validateDataConsistency() {
            logMessage('info', 'Validating data consistency across MCP servers...');
            
            // Simulate validation checks
            const checks = [
                'Employee data synchronization',
                'Asset allocation consistency', 
                'Notification delivery status',
                'Orchestration workflow integrity'
            ];
            
            for (const check of checks) {
                await new Promise(resolve => setTimeout(resolve, 500));
                logMessage('success', `‚úì ${check} - OK`);
                incrementTest(true);
            }
            
            displayResult('integration-results', 'Data Consistency Validation', {
                success: true,
                checks: checks,
                timestamp: new Date().toISOString()
            });
        }

        // Additional Helper Functions
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleFullscreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen();
            }
        }

        function closeModal() {
            document.getElementById('result-modal').style.display = 'none';
        }

        // Error scenario testing
        async function testErrorScenarios() {
            logMessage('info', 'Testing error scenarios...');
            
            const errorTests = [
                { name: 'Invalid Email Format', data: { email: 'invalid-email' } },
                { name: 'Missing Required Fields', data: { firstName: 'John' } },
                { name: 'Duplicate Employee', data: { email: 'existing@company.com' } }
            ];
            
            for (const test of errorTests) {
                try {
                    await simulateAPICall('POST', 'http://localhost:8080/mcp/tools/orchestrate-employee-onboarding', test.data);
                    logMessage('warning', `${test.name} - Expected error but got success`);
                } catch (error) {
                    logMessage('success', `${test.name} - Error handled correctly: ${error.message}`);
                    incrementTest(true);
                }
            }
        }

        // Additional endpoint testing functions
        async function testEmployeeEndpoints() {
            const endpoints = [
                { method: 'GET', path: '/health' },
                { method: 'GET', path: '/mcp/info' },
                { method: 'GET', path: '/mcp/tools/get-employees' }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    await simulateAPICall(endpoint.method, `http://localhost:8081${endpoint.path}`);
                    logMessage('success', `Employee MCP ${endpoint.method} ${endpoint.path} - OK`);
                    incrementTest(true);
                } catch (error) {
                    logMessage('error', `Employee MCP ${endpoint.method} ${endpoint.path} - Failed: ${error.message}`);
                    incrementTest(false);
                }
            }
        }

        async function testAssetEndpoints() {
            const endpoints = [
                { method: 'GET', path: '/health' },
                { method: 'GET', path: '/mcp/tools/get-available-assets' },
                { method: 'GET', path: '/mcp/tools/get-assets-by-employee/EMP001' }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    await simulateAPICall(endpoint.method, `http://localhost:8082${endpoint.path}`);
                    logMessage('success', `Asset MCP ${endpoint.method} ${endpoint.path} - OK`);
                    incrementTest(true);
                } catch (error) {
                    logMessage('error', `Asset MCP ${endpoint.method} ${endpoint.path} - Failed: ${error.message}`);
                    incrementTest(false);
                }
            }
        }

        async function testNotificationEndpoints() {
            const endpoints = [
                { method: 'GET', path: '/health' },
                { method: 'POST', path: '/mcp/tools/send-welcome-email' },
                { method: 'POST', path: '/mcp/tools/send-asset-notification' }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const testData = endpoint.method === 'POST' ? { email: 'test@company.com' } : null;
                    await simulateAPICall(endpoint.method, `http://localhost:8083${endpoint.path}`, testData);
                    logMessage('success', `Notification MCP ${endpoint.method} ${endpoint.path} - OK`);
                    incrementTest(true);
                } catch (error) {
                    logMessage('error', `Notification MCP ${endpoint.method} ${endpoint.path} - Failed: ${error.message}`);
                    incrementTest(false);
                }
            }
        }

        // Status monitoring functions
        async function testGetOnboardingStatus() {
            const employeeId = document.getElementById('status-employee-id').value;
            const email = document.getElementById('status-employee-email').value;
            
            if (!employeeId && !email) {
                alert('Please enter either Employee ID or Email');
                return;
            }
            
            try {
                const params = employeeId ? { employeeId } : { email };
                logMessage('info', `Getting onboarding status for: ${JSON.stringify(params)}`);
                
                const response = await simulateAPICall('GET', 'http://localhost:8080/mcp/tools/get-onboarding-status', params);
                
                displayResult('orchestration-results', 'Onboarding Status', {
                    success: true,
                    params: params,
                    status: response.data
                });
                
                logMessage('success', 'Onboarding status retrieved successfully');
                incrementTest(true);
                
            } catch (error) {
                logMessage('error', `Failed to get onboarding status: ${error.message}`);
                incrementTest(false);
            }
        }

        async function testRetryFailedStep() {
            const employeeId = document.getElementById('status-employee-id').value;
            
            if (!employeeId) {
                alert('Please enter Employee ID');
                return;
            }
            
            try {
                logMessage('info', `Retrying failed step for employee: ${employeeId}`);
                
                const response = await simulateAPICall('POST', 'http://localhost:8080/mcp/tools/retry-failed-step', {
                    employeeId: employeeId,
                    step: 'asset-allocation'
                });
                
                displayResult('orchestration-results', 'Retry Failed Step', {
                    success: true,
                    employeeId: employeeId,
                    result: response.data
                });
                
                logMessage('success', 'Step retry initiated successfully');
                incrementTest(true);
                
            } catch (error) {
                logMessage('error', `Failed to retry step: ${error.message}`);
                incrementTest(false);
            }
        }

        // Multi-user and concurrent testing
        async function runMultiUserScenario() {
            logMessage('info', 'Starting multi-user scenario test...');
            
            const users = [
                { firstName: 'Alice', lastName: 'Johnson', email: 'alice.j@company.com', department: 'Engineering' },
                { firstName: 'Bob', lastName: 'Smith', email: 'bob.s@company.com', department: 'Marketing' },
                { firstName: 'Carol', lastName: 'Williams', email: 'carol.w@company.com', department: 'Sales' }
            ];
            
            const promises = users.map(user => testOrchestration({
                ...user,
                position: 'Developer',
                startDate: new Date().toISOString().split('T')[0],
                assets: ['laptop', 'phone']
            }));
            
            try {
                await Promise.all(promises);
                logMessage('success', 'Multi-user scenario completed successfully');
            } catch (error) {
                logMessage('error', `Multi-user scenario failed: ${error.message}`);
            }
        }

        async function testConcurrentRequests() {
            logMessage('info', 'Testing concurrent request handling...');
            
            const concurrentRequests = 10;
            const promises = [];
            
            for (let i = 0; i < concurrentRequests; i++) {
                promises.push(simulateAPICall('GET', 'http://localhost:8080/health'));
            }
            
            try {
                const results = await Promise.allSettled(promises);
                const successful = results.filter(r => r.status === 'fulfilled').length;
                
                logMessage('success', `Concurrent requests test: ${successful}/${concurrentRequests} successful`);
                
                displayResult('integration-results', 'Concurrent Requests Test', {
                    total: concurrentRequests,
                    successful: successful,
                    successRate: (successful / concurrentRequests) * 100
                });
                
                incrementTest(successful === concurrentRequests);
                
            } catch (error) {
                logMessage('error', `Concurrent requests test failed: ${error.message}`);
                incrementTest(false);
            }
        }

        async function testRollbackScenario() {
            logMessage('info', 'Testing rollback scenario...');
            
            // Simulate a failed orchestration that requires rollback
            try {
                logMessage('info', 'Simulating failed orchestration...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                logMessage('info', 'Initiating rollback procedure...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                logMessage('success', 'Rollback completed successfully');
                
                displayResult('integration-results', 'Rollback Test', {
                    success: true,
                    message: 'System successfully rolled back from failed state',
                    timestamp: new Date().toISOString()
                });
                
                incrementTest(true);
                
            } catch (error) {
                logMessage('error', `Rollback test failed: ${error.message}`);
                incrementTest(false);
            }
        }

        // Additional utility functions
        async function testGetEmployees() {
            try {
                logMessage('info', 'Retrieving all employees...');
                const response = await simulateAPICall('GET', 'http://localhost:8081/mcp/tools/get-employees');
                
                displayResult('individual-results', 'Get Employees', {
                    success: true,
                    employees: [
                        { id: 'EMP001', name: 'John Doe', email: 'john@company.com', status: 'ACTIVE' },
                        { id: 'EMP002', name: 'Jane Smith', email: 'jane@company.com', status: 'ACTIVE' }
                    ]
                });
                
                logMessage('success', 'Employee list retrieved successfully');
                incrementTest(true);
                
            } catch (error) {
                logMessage('error', `Failed to get employees: ${error.message}`);
                displayResult('individual-results', 'Get Employees Failed', { success: false, error: error.message });
                incrementTest(false);
            }
        }

        async function testGetEmployeeById() {
            try {
                const employeeId = 'EMP001';
                logMessage('info', `Retrieving employee by ID: ${employeeId}`);
                
                const response = await simulateAPICall('GET', `http://localhost:8081/mcp/tools/get-employee/${employeeId}`);
                
                displayResult('individual-results', 'Get Employee by ID', {
                    success: true,
                    employee: { id: employeeId, name: 'John Doe', email: 'john@company.com', status: 'ACTIVE' }
                });
                
                logMessage('success', `Employee ${employeeId} retrieved successfully`);
                incrementTest(true);
                
            } catch (error) {
                logMessage('error', `Failed to get employee: ${error.message}`);
                incrementTest(false);
            }
        }

        async function testGetAvailableAssets() {
            try {
                logMessage('info', 'Retrieving available assets...');
                const response = await simulateAPICall('GET', 'http://localhost:8082/mcp/tools/get-available-assets');
                
                displayResult('individual-results', 'Get Available Assets', {
                    success: true,
                    assets: [
                        { id: 'LAPTOP001', type: 'laptop', status: 'available', model: 'Dell XPS 13' },
                        { id: 'PHONE001', type: 'phone', status: 'available', model: 'iPhone 14' },
                        { id: 'MONITOR001', type: 'monitor', status: 'available', model: 'Samsung 24"' }
                    ]
                });
                
                logMessage('success', 'Available assets retrieved successfully');
                incrementTest(true);
                
            } catch (error) {
                logMessage('error', `Failed to get available assets: ${error.message}`);
                incrementTest(false);
            }
        }

        async function testGetAssetsByEmployee() {
            try {
                const employeeId = document.getElementById('asset-employee-id').value || 'EMP001';
                logMessage('info', `Retrieving assets for employee: ${employeeId}`);
                
                const response = await simulateAPICall('GET', `http://localhost:8082/mcp/tools/get-assets-by-employee/${employeeId}`);
                
                displayResult('individual-results', 'Get Assets by Employee', {
                    success: true,
                    employeeId: employeeId,
                    assets: [
                        { id: 'LAPTOP001', type: 'laptop', status: 'allocated', allocationDate: '2024-01-15' },
                        { id: 'PHONE001', type: 'phone', status: 'allocated', allocationDate: '2024-01-15' }
                    ]
                });
                
                logMessage('success', `Assets for employee ${employeeId} retrieved successfully`);
                incrementTest(true);
                
            } catch (error) {
                logMessage('error', `Failed to get employee assets: ${error.message}`);
                incrementTest(false);
            }
        }

        async function testSendAssetNotification() {
            try {
                const email = document.getElementById('notif-email').value;
                const name = document.getElementById('notif-name').value;
                
                const notificationData = {
                    email: email,
                    name: name,
                    assets: ['laptop', 'phone'],
                    template: 'asset-allocation'
                };

                logMessage('info', `Sending asset notification to ${email}`);
                await simulateAPICall('POST', 'http://localhost:8083/mcp/tools/send-asset-notification', notificationData);
                
                displayResult('individual-results', 'Asset Allocation Notification', {
                    success: true,
                    data: notificationData
                });
                
                logMessage('success', 'Asset notification sent successfully');
                incrementTest(true);
                
            } catch (error) {
                logMessage('error', `Asset notification failed: ${error.message}`);
                displayResult('individual-results', 'Asset Notification Failed', { success: false, error: error.message });
                incrementTest(false);
            }
        }

        async function testSendOnboardingComplete() {
            try {
                const email = document.getElementById('notif-email').value;
                const name = document.getElementById('notif-name').value;
                
                const completionData = {
                    email: email,
                    name: name,
                    template: 'onboarding-complete'
                };

                logMessage('info', `Sending onboarding completion notification to ${email}`);
                await simulateAPICall('POST', 'http://localhost:8083/mcp/tools/send-onboarding-complete', completionData);
                
                displayResult('individual-results', 'Onboarding Complete Notification', {
                    success: true,
                    data: completionData
                });
                
                logMessage('success', 'Onboarding completion notification sent successfully');
                incrementTest(true);
                
            } catch (error) {
                logMessage('error', `Onboarding completion notification failed: ${error.message}`);
                displayResult('individual-results', 'Completion Notification Failed', { success: false, error: error.message });
                incrementTest(false);
            }
        }

        // Enter key support for chat input
        document.addEventListener('keydown', function(event) {
            if (event.target.id === 'chat-input' && event.key === 'Enter') {
                event.preventDefault();
                sendChatMessage();
            }
        });

        // Auto-save form data to localStorage
        function saveFormData() {
            const formData = {
                quickEmployeeName: document.getElementById('quick-employee-name')?.value || '',
                quickEmployeeEmail: document.getElementById('quick-employee-email')?.value || '',
                orchFirstname: document.getElementById('orch-firstname')?.value || '',
                orchLastname: document.getElementById('orch-lastname')?.value || '',
                orchEmail: document.getElementById('orch-email')?.value || ''
            };
            localStorage.setItem('mcpTestSuiteFormData', JSON.stringify(formData));
        }

        function loadFormData() {
            try {
                const saved = localStorage.getItem('mcpTestSuiteFormData');
                if (saved) {
                    const formData = JSON.parse(saved);
                    Object.keys(formData).forEach(key => {
                        const element = document.getElementById(key.replace(/([A-Z])/g, '-$1').toLowerCase());
                        if (element && formData[key]) {
                            element.value = formData[key];
                        }
                    });
                }
            } catch (error) {
                console.log('Failed to load saved form data:', error);
            }
        }

        // Save form data periodically
        setInterval(saveFormData, 10000); // Every 10 seconds

        // Load form data on page load
        window.addEventListener('load', loadFormData);
    </script>
</body>
</html>
